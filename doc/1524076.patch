From 282d16bbd9b394ef5ee67800284dd898617da997 Mon Sep 17 00:00:00 2001
From: "Ellen (Yufei) Chen" <chenellen007@gmail.com>
Date: Fri, 15 Nov 2019 00:55:55 -0500
Subject: [PATCH] Bug 1524076 - Fixed pasted recipient email address
 autocompletes to more popular primary email address

---
 mailnews/addrbook/src/nsAbAutoCompleteSearch.js | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/mailnews/addrbook/src/nsAbAutoCompleteSearch.js b/mailnews/addrbook/src/nsAbAutoCompleteSearch.js
index 44ebd04136..c69fa3433e 100644
--- a/mailnews/addrbook/src/nsAbAutoCompleteSearch.js
+++ b/mailnews/addrbook/src/nsAbAutoCompleteSearch.js
@@ -153,9 +153,15 @@ nsAbAutoCompleteSearch.prototype = {
    */
   _getScore(aCard, aAddress, aSearchString) {
     const BEST = 100;
+    // First check whether the search string matches the email for the card
+    const addressStartIdx = aAddress.indexOf("<") + 1;
+    const address = aAddress.substr(addressStartIdx, aAddress.length - 1);
+    if (address == aSearchString) {
+      return BEST + 1;
+    }
 
-    // We will firstly check if the search term provided by the user
-    // is the nick name for the card or at least in the beginning of it.
+    // Then check if the search term provided by the user is
+    // the nick name for the card or at least in the beginning of it.
     let nick = aCard.getProperty("NickName", "").toLocaleLowerCase();
     aSearchString = aSearchString.toLocaleLowerCase();
     if (nick == aSearchString) {
-- 
2.21.0.windows.1

